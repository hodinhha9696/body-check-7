<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Body Check 7 ‚Äì Test s·ª©c kh·ªèe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color-scheme: light dark;
    }

    body {
      margin: 0;
      padding: 0;
      background: #f5f5f7;
      color: #111827;
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      background: #ffffff;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.08);
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 16px 20px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    header h1 {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
    }

    .back-btn {
      border: none;
      background: transparent;
      font-size: 18px;
      cursor: pointer;
      padding: 4px 8px 4px 0;
    }

    main {
      flex: 1;
      padding: 20px 20px 24px;
      overflow-y: auto;
    }

    h2 {
      margin-top: 0;
    }

    .subtitle {
      color: #6b7280;
      font-size: 14px;
      margin-top: 4px;
      margin-bottom: 16px;
    }

    .card {
      background: #f9fafb;
      border-radius: 12px;
      padding: 14px 16px;
      border: 1px solid #e5e7eb;
      margin-bottom: 12px;
    }

    .card-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 14px;
    }

    .card-body {
      font-size: 13px;
      color: #4b5563;
      line-height: 1.5;
    }

    .disclaimer {
      background: #fff7ed;
      border: 1px solid #fed7aa;
      color: #9a3412;
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 13px;
      margin-top: 12px;
    }

    .btn-primary,
    .btn-secondary,
    .btn-text {
      width: 100%;
      border-radius: 999px;
      padding: 12px 16px;
      font-size: 15px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      margin-top: 12px;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
    }

    .btn-primary:disabled {
      background: #9ca3af;
      cursor: default;
    }

    .btn-secondary {
      background: white;
      border: 1px solid #d1d5db;
      color: #111827;
    }

    .btn-text {
      background: transparent;
      color: #2563eb;
      font-weight: 500;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    .btn-row .btn-primary,
    .btn-row .btn-secondary {
      width: 50%;
      margin-top: 0;
    }

    .bullet {
      font-size: 14px;
      margin-bottom: 4px;
      color: #374151;
    }

    .progress-container {
      margin-bottom: 12px;
    }

    .progress-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 4px;
    }

    .progress-bar-bg {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      width: 0;
      background: #2563eb;
      transition: width 0.2s ease-out;
    }

    .question-text {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 12px;
    }

    .likert-label {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 8px;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 8px;
    }

    .option-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .option-row input {
      transform: scale(1.15);
    }

    .help-text {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .overall-score {
      font-size: 32px;
      font-weight: 700;
      margin: 4px 0;
    }

    .overall-label {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 8px;
    }

    .overall-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .overall-message {
      font-size: 14px;
      color: #4b5563;
      line-height: 1.5;
    }

    .group-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
    }

    .group-name {
      font-weight: 600;
      font-size: 14px;
    }

    .group-score {
      font-size: 13px;
      color: #6b7280;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      margin-top: 2px;
    }

    .chip.good {
      background: #ecfdf5;
      color: #15803d;
    }

    .chip.medium {
      background: #fffbeb;
      color: #b45309;
    }

    .chip.low {
      background: #fef2f2;
      color: #b91c1c;
    }

    .toast {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(15, 23, 42, 0.95);
      color: #f9fafb;
      padding: 10px 14px;
      border-radius: 999px;
      font-size: 13px;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease-out, transform 0.2s ease-out;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
      pointer-events: auto;
    }
  </style>
</head>
<body>
<div class="app">
  <header id="app-header">
    <button class="back-btn" id="back-btn" style="display:none;">‚Äπ</button>
    <h1 id="header-title">Body Check 7</h1>
  </header>

  <main>
    <!-- INTRO SCREEN -->
    <section id="screen-intro">
      <h2>Body Check 7</h2>
      <p class="subtitle">B√†i test s·ª©c kh·ªèe 3 ph√∫t ‚Äì d·ª±a tr√™n 7 d·∫•u hi·ªáu sinh h·ªçc quan tr·ªçng.</p>

      <p class="bullet">‚Ä¢ 14 c√¢u h·ªèi tr·∫Øc nghi·ªám d·ªÖ hi·ªÉu</p>
      <p class="bullet">‚Ä¢ Kh√¥ng c·∫ßn nh·∫≠p th√¥ng tin c√° nh√¢n</p>
      <p class="bullet">‚Ä¢ K·∫øt qu·∫£ ph√¢n t√≠ch chi ti·∫øt theo t·ª´ng nh√≥m</p>

      <div class="disclaimer">
        ‚ö†Ô∏è B√†i test ch·ªâ mang t√≠nh tham kh·∫£o, kh√¥ng thay th·∫ø t∆∞ v·∫•n y khoa ho·∫∑c ch·∫©n ƒëo√°n b·ªánh l√Ω.
      </div>

      <button class="btn-primary" id="btn-start-quiz">B·∫ÆT ƒê·∫¶U B√ÄI TEST</button>
      <button class="btn-text" id="btn-view-signs">Xem 7 d·∫•u hi·ªáu s·ª©c kh·ªèe ‚Üí</button>
    </section>

    <!-- 7 SIGNS SCREEN -->
    <section id="screen-signs" style="display:none;">
      <h2>7 d·∫•u hi·ªáu s·ª©c kh·ªèe</h2>
      <p class="subtitle">
        7 nh√≥m ch·ªâ s·ªë m√† b√†i test s·∫Ω ƒë√°nh gi√°. ƒê·ªçc nhanh ƒë·ªÉ hi·ªÉu m√¨nh ƒëang ‚Äúcheck‚Äù ƒëi·ªÅu g√¨.
      </p>

      <div class="card">
        <div class="card-title">1. NƒÉng l∆∞·ª£ng ·ªïn ƒë·ªãnh c·∫£ ng√†y</div>
        <div class="card-body">
          Kh√¥ng u·ªÉ o·∫£i bu·ªïi s√°ng, kh√¥ng ƒëu·ªëi s·ª©c bu·ªïi chi·ªÅu. ƒê√¢y l√† d·∫•u hi·ªáu chuy·ªÉn h√≥a t·ªët,
          insulin ·ªïn ƒë·ªãnh v√† tuy·∫øn th∆∞·ª£ng th·∫≠n kh·ªèe.
        </div>
      </div>

      <div class="card">
        <div class="card-title">2. Ng·ªß nhanh ‚Äì ng·ªß s√¢u ‚Äì d·∫≠y t·ªânh t√°o</div>
        <div class="card-body">
          Ng·ªß ngon l√† ‚Äúx√©t nghi·ªám mi·ªÖn ph√≠‚Äù cho s·ª©c kh·ªèe. D·ªÖ ng·ªß, kh√¥ng tr·∫±n tr·ªçc, kh√¥ng th·ª©c gi·ªØa ƒë√™m
          l√† d·∫•u hi·ªáu th·∫ßn kinh, n·ªôi ti·∫øt v√† nh·ªãp sinh h·ªçc ƒëang ƒëi·ªÅu h√≤a t·ªët.
        </div>
      </div>

      <div class="card">
        <div class="card-title">3. C√¢n n·∫∑ng ·ªïn ƒë·ªãnh, v√≤ng eo kh√¥ng tƒÉng th·∫•t th∆∞·ªùng</div>
        <div class="card-body">
          Khi insulin, cortisol v√† tuy·∫øn gi√°p ho·∫°t ƒë·ªông c√¢n b·∫±ng, c∆° th·ªÉ t·ª± gi·ªØ c√¢n n·∫∑ng kh·ªèe m·∫°nh,
          kh√¥ng tƒÉng gi·∫£m v√¥ l√Ω.
        </div>
      </div>

      <div class="card">
        <div class="card-title">4. Da v√† m√≥ng h·ªìng h√†o</div>
        <div class="card-body">
          Da s√°ng, m√≥ng h·ªìng t·ª± nhi√™n l√† d·∫•u hi·ªáu kh√≠ huy·∫øt t·ªët, tu·∫ßn ho√†n ·ªïn ƒë·ªãnh, h·ªá ti√™u ho√° ‚Äì gan ‚Äì th·∫≠n ho·∫°t ƒë·ªông kh·ªèe.
        </div>
      </div>

      <div class="card">
        <div class="card-title">5. C·∫£m x√∫c ·ªïn ƒë·ªãnh, tinh th·∫ßn nh·∫π nh√†ng</div>
        <div class="card-body">
          Stress m√£n t√≠nh ph√° hormone nhanh h∆°n tu·ªïi t√°c. N·∫øu b·∫°n √≠t c√°u g·∫Øt, √≠t lo √¢u v√† d·ªÖ l·∫•y l·∫°i b√¨nh tƒ©nh ‚Äì c∆° th·ªÉ
          b·∫°n ƒëang ·ªü tr·∫°ng th√°i ‚Äúan to√†n sinh h·ªçc‚Äù.
        </div>
      </div>

      <div class="card">
        <div class="card-title">6. Ti√™u h√≥a t·ªët, ƒÉn u·ªëng ngon mi·ªáng</div>
        <div class="card-body">
          Kh√¥ng ƒë·∫ßy b·ª•ng, kh√¥ng t√°o b√≥n, kh√¥ng r·ªëi lo·∫°n ti√™u h√≥a. 70% mi·ªÖn d·ªãch n·∫±m ·ªü h·ªá ti√™u h√≥a ‚Äì n√™n ƒë√¢y l√† n·ªÅn t·∫£ng c·ªßa s·ª©c kh·ªèe.
        </div>
      </div>

      <div class="card">
        <div class="card-title">7. √çt ·ªëm v·∫∑t, h·ªìi ph·ª•c nhanh</div>
        <div class="card-body">
          √çt c·∫£m v·∫∑t, h·ªìi ph·ª•c nhanh sau ·ªëm l√† d·∫•u hi·ªáu h·ªá mi·ªÖn d·ªãch kh·ªèe, c∆° th·ªÉ ch·ªëng l·∫°i virus, vi khu·∫©n hi·ªáu qu·∫£.
        </div>
      </div>

      <button class="btn-primary" id="btn-signs-start">TI·∫æP T·ª§C L√ÄM B√ÄI TEST</button>
    </section>

    <!-- QUIZ SCREEN -->
    <section id="screen-quiz" style="display:none;">
      <div class="progress-container">
        <div class="progress-top">
          <span id="progress-text">C√¢u 1 / 14</span>
        </div>
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" id="progress-bar"></div>
        </div>
      </div>

      <p class="help-text">
        H√£y tr·∫£ l·ªùi theo t√¨nh tr·∫°ng 3‚Äì6 th√°ng g·∫ßn ƒë√¢y c·ªßa b·∫°n.
      </p>

      <div class="question-text" id="question-text"></div>
      <div class="likert-label">M·ª©c ƒë·ªô ƒë√∫ng v·ªõi b·∫°n:</div>

      <div class="options" id="options-container">
        <!-- radio options will be injected here -->
      </div>

      <div class="help-text">
        1 = Ho√†n to√†n kh√¥ng ƒë√∫ng ¬∑ 5 = G·∫ßn nh∆∞ lu√¥n lu√¥n ƒë√∫ng
      </div>

      <div class="btn-row">
        <button class="btn-secondary" id="btn-prev">Quay l·∫°i</button>
        <button class="btn-primary" id="btn-next">Ti·∫øp t·ª•c</button>
      </div>
    </section>

    <!-- RESULT SCREEN -->
    <section id="screen-result" style="display:none;">
      <h2>üéâ K·∫øt qu·∫£ b√†i test</h2>
      <div id="overall-block">
        <div class="overall-label">ƒêi·ªÉm trung b√¨nh c·ªßa b·∫°n</div>
        <div class="overall-score" id="overall-score">0.0 / 5</div>
        <div class="overall-title" id="overall-title"></div>
        <div class="overall-message" id="overall-message"></div>
      </div>

      <h3 style="margin-top:18px; font-size:15px;">T√≥m t·∫Øt 7 nh√≥m ch·ªâ s·ªë</h3>
      <div id="groups-list"></div>

      <button class="btn-primary" id="btn-view-details">XEM PH√ÇN T√çCH CHI TI·∫æT</button>
      <button class="btn-secondary" id="btn-restart">L√ÄM L·∫†I B√ÄI TEST</button>
    </section>

    <!-- RESULT DETAIL SCREEN -->
    <section id="screen-detail" style="display:none;">
      <h2>Ph√¢n t√≠ch chi ti·∫øt</h2>
      <p class="subtitle">
        M·ªói nh√≥m t∆∞∆°ng ·ª©ng v·ªõi m·ªôt m·∫£ng quan tr·ªçng. H√£y xem nh√≥m n√†o l√† ‚Äúƒëi·ªÉm m·∫°nh‚Äù v√† nh√≥m n√†o c·∫ßn ∆∞u ti√™n c·∫£i thi·ªán.
      </p>
      <div id="detail-list"></div>

      <button class="btn-secondary" id="btn-detail-back">Quay l·∫°i k·∫øt qu·∫£</button>
      <button class="btn-text" id="btn-detail-home">V·ªÅ trang ch·ªß</button>
    </section>
  </main>
</div>

<div class="toast" id="toast"></div>

<script>
  // ---------- DATA & LOGIC ----------

  const QUESTIONS = [
    { id: 1, groupId: 1, text: "Bu·ªïi s√°ng sau khi ng·ªß d·∫≠y, t√¥i c·∫£m th·∫•y t·ªânh t√°o, kh√¥ng u·ªÉ o·∫£i k√©o d√†i." },
    { id: 2, groupId: 1, text: "Bu·ªïi chi·ªÅu/t·ªëi t√¥i v·∫´n c√≤n ƒë·ªß nƒÉng l∆∞·ª£ng ƒë·ªÉ l√†m vi·ªác, kh√¥ng b·ªã t·ª•t pin r√µ r·ªát." },

    { id: 3, groupId: 2, text: "T√¥i th∆∞·ªùng d·ªÖ ng·ªß, kh√¥ng m·∫•t nhi·ªÅu th·ªùi gian tr·∫±n tr·ªçc." },
    { id: 4, groupId: 2, text: "T√¥i ng·ªß m·ªôt m·∫°ch t·ªõi s√°ng, √≠t ho·∫∑c kh√¥ng b·ªã th·ª©c gi·∫•c gi·ªØa ƒë√™m v√† khi d·∫≠y th·∫•y minh m·∫´n." },

    { id: 5, groupId: 3, text: "C√¢n n·∫∑ng c·ªßa t√¥i t∆∞∆°ng ƒë·ªëi ·ªïn ƒë·ªãnh, kh√¥ng tƒÉng/gi·∫£m nhanh b·∫•t th∆∞·ªùng trong v√†i th√°ng qua." },
    { id: 6, groupId: 3, text: "V√≤ng eo/b·ª•ng c·ªßa t√¥i kh√¥ng ph√¨nh to th·∫•t th∆∞·ªùng d√π ch·∫ø ƒë·ªô ƒÉn v√† v·∫≠n ƒë·ªông kh√¥ng thay ƒë·ªïi qu√° nhi·ªÅu." },

    { id: 7, groupId: 4, text: "Da c·ªßa t√¥i nh√¨n chung s√°ng/ƒë·ªÅu m√†u, kh√¥ng x·ªân, kh√¥ng nh·ª£t nh·∫°t k√©o d√†i." },
    { id: 8, groupId: 4, text: "M√≥ng tay/m√≥ng ch√¢n c·ªßa t√¥i h·ªìng h√†o t·ª± nhi√™n, kh√¥ng d·ªÖ g√£y, kh√¥ng ƒë·ªïi m√†u b·∫•t th∆∞·ªùng." },

    { id: 9, groupId: 5, text: "Trong ng√†y, t√¥i √≠t b·ªã c√°u g·∫Øt v√¥ c·ªõ, kh√¥ng d·ªÖ b√πng n·ªï c·∫£m x√∫c v√¨ chuy·ªán nh·ªè." },
    { id: 10, groupId: 5, text: "Khi g·∫∑p stress, t√¥i t∆∞∆°ng ƒë·ªëi d·ªÖ l·∫•y l·∫°i b√¨nh tƒ©nh, kh√¥ng b·ªã lo √¢u k√©o d√†i." },

    { id: 11, groupId: 6, text: "T√¥i √≠t b·ªã ƒë·∫ßy b·ª•ng, ·ª£ h∆°i, kh√≥ ti√™u sau b·ªØa ƒÉn." },
    { id: 12, groupId: 6, text: "T√¥i ƒëi ti√™u ƒë·ªÅu ƒë·∫∑n, kh√¥ng hay b·ªã t√°o b√≥n ho·∫∑c r·ªëi lo·∫°n ti√™u ho√° k√©o d√†i." },

    { id: 13, groupId: 7, text: "T√¥i √≠t b·ªã ·ªëm v·∫∑t (c·∫£m c√∫m, vi√™m h·ªçng, s·ªët nh·∫π‚Ä¶) trong v√†i th√°ng g·∫ßn ƒë√¢y." },
    { id: 14, groupId: 7, text: "Khi b·ªã m·ªát/c·∫£m, c∆° th·ªÉ t√¥i th∆∞·ªùng h·ªìi ph·ª•c kh√° nhanh sau khi ngh·ªâ ng∆°i." },
  ];

  const GROUP_NAMES = {
    1: "NƒÉng l∆∞·ª£ng trong ng√†y",
    2: "Gi·∫•c ng·ªß",
    3: "C√¢n n·∫∑ng & v√≤ng eo",
    4: "Da & m√≥ng",
    5: "C·∫£m x√∫c & tinh th·∫ßn",
    6: "Ti√™u ho√°",
    7: "Mi·ªÖn d·ªãch & h·ªìi ph·ª•c",
  };

  let currentIndex = 0; // index trong m·∫£ng QUESTIONS
  let answers = {}; // { questionId: value 1-5 }
  let resultCache = null;

  function showToast(message) {
    const toast = document.getElementById("toast");
    toast.textContent = message;
    toast.classList.add("show");
    setTimeout(() => {
      toast.classList.remove("show");
    }, 2200);
  }

  function showScreen(screenId) {
    const screens = [
      "screen-intro",
      "screen-signs",
      "screen-quiz",
      "screen-result",
      "screen-detail",
    ];
    screens.forEach(id => {
      document.getElementById(id).style.display = (id === screenId) ? "block" : "none";
    });

    // Header title + back button logic
    const headerTitle = document.getElementById("header-title");
    const backBtn = document.getElementById("back-btn");

    if (screenId === "screen-intro") {
      headerTitle.textContent = "Body Check 7";
      backBtn.style.display = "none";
    } else if (screenId === "screen-signs") {
      headerTitle.textContent = "7 d·∫•u hi·ªáu";
      backBtn.style.display = "inline-block";
    } else if (screenId === "screen-quiz") {
      headerTitle.textContent = "B√†i test s·ª©c kh·ªèe";
      backBtn.style.display = "inline-block";
    } else if (screenId === "screen-result") {
      headerTitle.textContent = "K·∫øt qu·∫£";
      backBtn.style.display = "inline-block";
    } else if (screenId === "screen-detail") {
      headerTitle.textContent = "Chi ti·∫øt 7 nh√≥m";
      backBtn.style.display = "inline-block";
    }
  }

  function renderQuestion() {
    const q = QUESTIONS[currentIndex];
    const questionText = document.getElementById("question-text");
    const optionsContainer = document.getElementById("options-container");
    const progressText = document.getElementById("progress-text");
    const progressBar = document.getElementById("progress-bar");
    const nextBtn = document.getElementById("btn-next");
    const prevBtn = document.getElementById("btn-prev");

    questionText.textContent = q.text;
    progressText.textContent = `C√¢u ${currentIndex + 1} / ${QUESTIONS.length}`;

    const percent = ((currentIndex + 1) / QUESTIONS.length) * 100;
    progressBar.style.width = percent + "%";

    optionsContainer.innerHTML = "";
    const labels = {
      1: "Ho√†n to√†n kh√¥ng ƒë√∫ng",
      2: "Th·ªânh tho·∫£ng ƒë√∫ng",
      3: "ƒê√∫ng kho·∫£ng 50%",
      4: "ƒê√∫ng ph·∫ßn l·ªõn th·ªùi gian",
      5: "G·∫ßn nh∆∞ lu√¥n lu√¥n ƒë√∫ng",
    };

    const existing = answers[q.id];

    for (let value = 1; value <= 5; value++) {
      const row = document.createElement("label");
      row.className = "option-row";

      const input = document.createElement("input");
      input.type = "radio";
      input.name = "answer";
      input.value = value.toString();

      if (existing === value) {
        input.checked = true;
      }

      const span = document.createElement("span");
      span.textContent = `${value} ‚Äì ${labels[value]}`;

      row.appendChild(input);
      row.appendChild(span);
      optionsContainer.appendChild(row);
    }

    prevBtn.disabled = currentIndex === 0;
    nextBtn.textContent = (currentIndex === QUESTIONS.length - 1) ? "Xem k·∫øt qu·∫£" : "Ti·∫øp t·ª•c";
  }

  function classifyOverall(average) {
    const total = average * QUESTIONS.length;

    if (average >= 4.3) {
      return {
        average,
        total,
        status: "excellent",
        title: "üíö C∆° th·ªÉ ƒëang r·∫•t c√¢n b·∫±ng",
        message:
          "NƒÉng l∆∞·ª£ng, gi·∫•c ng·ªß, ti√™u ho√° v√† c·∫£m x√∫c c·ªßa b·∫°n ƒëang ·ªü tr·∫°ng th√°i kh√° ·ªïn ƒë·ªãnh. ƒê√¢y l√† d·∫•u hi·ªáu t·ªët cho s·ª©c kh·ªèe t·ªïng th·ªÉ. H√£y ti·∫øp t·ª•c duy tr√¨ th√≥i quen s·ªëng hi·ªán t·∫°i v√† qu·∫£n l√Ω stress hi·ªáu qu·∫£.",
      };
    }

    if (average >= 3.5) {
      return {
        average,
        total,
        status: "good",
        title: "üíõ S·ª©c kh·ªèe t·ªët, c·∫ßn t·ªëi ∆∞u th√™m",
        message:
          "S·ª©c kh·ªèe c·ªßa b·∫°n nh√¨n chung kh√° t·ªët, ch·ªâ c√≥ m·ªôt v√†i nh√≥m ch·ªâ s·ªë c·∫ßn ƒë∆∞·ª£c chƒÉm ch√∫t th√™m. H√£y xem k·ªπ ph√¢n t√≠ch t·ª´ng m·ª•c ƒë·ªÉ bi·∫øt m√¨nh n√™n b·∫Øt ƒë·∫ßu c·∫£i thi·ªán ·ªü ƒë√¢u.",
      };
    }

    if (average >= 2.5) {
      return {
        average,
        total,
        status: "warning",
        title: "üß° C∆° th·ªÉ ƒëang c·∫ßn b·∫°n ch√∫ √Ω h∆°n",
        message:
          "C∆° th·ªÉ ƒëang g·ª≠i cho b·∫°n v√†i t√≠n hi·ªáu c·∫£nh b√°o nh·∫π: c√≥ th·ªÉ l√† m·ªát m·ªèi, ng·ªß kh√¥ng s√¢u, ti√™u ho√° ho·∫∑c c·∫£m x√∫c ch∆∞a ·ªïn ƒë·ªãnh. B·∫°n n√™n ∆∞u ti√™n ngh·ªâ ng∆°i, ƒÉn u·ªëng l√†nh m·∫°nh h∆°n v√† theo d√µi k·ªπ s·ª± thay ƒë·ªïi.",
      };
    }

    return {
      average,
      total,
      status: "critical",
      title: "‚ù§Ô∏è‚Äçü©π N√™n ∆∞u ti√™n chƒÉm s√≥c s·ª©c kh·ªèe ngay",
      message:
        "Nhi·ªÅu ch·ªâ s·ªë s·ª©c kh·ªèe c·ªßa b·∫°n ƒëang ·ªü m·ª©c th·∫•p. ƒê√¢y l√† th·ªùi ƒëi·ªÉm n√™n nghi√™m t√∫c s·∫Øp x·∫øp l·∫°i l·ªëi s·ªëng v√† c√¢n nh·∫Øc trao ƒë·ªïi v·ªõi b√°c sƒ© ho·∫∑c chuy√™n gia s·ª©c kh·ªèe ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n c·ª• th·ªÉ.",
    };
  }

  function classifyGroupAverage(avg) {
    if (avg >= 4) return { status: "good", statusLabel: "T·ªët" };
    if (avg >= 3) return { status: "medium", statusLabel: "C·∫ßn ch√∫ √Ω" };
    return { status: "low", statusLabel: "∆Øu ti√™n c·∫£i thi·ªán" };
  }

  function getGroupMessage(groupId, avg) {
    switch (groupId) {
      case 1: // NƒÉng l∆∞·ª£ng
        if (avg >= 4) {
          return "NƒÉng l∆∞·ª£ng c·ªßa b·∫°n kh√° ·ªïn ƒë·ªãnh trong ng√†y. B·∫°n kh√¥ng b·ªã ‚Äòt·ª•t pin‚Äô qu√° m·∫°nh v√†o bu·ªïi chi·ªÅu, v√† bu·ªïi s√°ng th∆∞·ªùng kh√¥ng qu√° u·ªÉ o·∫£i. ƒê√¢y l√† d·∫•u hi·ªáu t·ªët cho chuy·ªÉn h√≥a, ƒë∆∞·ªùng huy·∫øt v√† tuy·∫øn th∆∞·ª£ng th·∫≠n.";
        }
        if (avg >= 3) {
          return "Th·ªânh tho·∫£ng b·∫°n v·∫´n c√≥ nh·ªØng ng√†y b·ªã ƒëu·ªëi s·ª©c, m·ªát m·ªèi ho·∫∑c kh√≥ kh·ªüi ƒë·ªông v√†o bu·ªïi s√°ng. H√£y xem l·∫°i gi·ªù ng·ªß, ch·∫•t l∆∞·ª£ng b·ªØa s√°ng v√† m·ª©c ƒë·ªô l√†m vi·ªác qu√° s·ª©c.";
        }
        return "C∆° th·ªÉ b·∫°n ƒëang d·ªÖ m·ªát ho·∫∑c h·ª•t nƒÉng l∆∞·ª£ng r√µ r·ªát trong ng√†y. B·∫°n n√™n ∆∞u ti√™n gi·∫•c ng·ªß, dinh d∆∞·ª°ng c∆° b·∫£n v√† c√¢n nh·∫Øc ki·ªÉm tra s·ª©c kh·ªèe t·ªïng qu√°t n·∫øu t√¨nh tr·∫°ng k√©o d√†i.";

      case 2: // Gi·∫•c ng·ªß
        if (avg >= 4) {
          return "Gi·∫•c ng·ªß c·ªßa b·∫°n ƒëang kh√° t·ªët: d·ªÖ ng·ªß, √≠t th·ª©c gi·∫•c gi·ªØa ƒë√™m v√† th∆∞·ªùng d·∫≠y trong tr·∫°ng th√°i t·ªânh t√°o. ƒê√¢y l√† d·∫•u hi·ªáu th·∫ßn kinh ‚Äì n·ªôi ti·∫øt ‚Äì nh·ªãp sinh h·ªçc ƒëang ƒëi·ªÅu ho√† ·ªïn.";
        }
        if (avg >= 3) {
          return "ƒê√¥i khi b·∫°n v·∫´n kh√≥ ng·ªß, tr·∫±n tr·ªçc ho·∫∑c th·ª©c gi·∫•c gi·ªØa ƒë√™m. H√£y th·ª≠ gi·∫£m d√πng m√†n h√¨nh tr∆∞·ªõc khi ng·ªß, h·∫°n ch·∫ø caffeine sau bu·ªïi chi·ªÅu v√† t·∫°o l·ªãch ng·ªß ƒë·ªÅu ƒë·∫∑n h∆°n.";
        }
        return "Gi·∫•c ng·ªß c·ªßa b·∫°n ƒëang g·∫∑p nhi·ªÅu v·∫•n ƒë·ªÅ: kh√≥ ng·ªß, hay th·ª©c gi·∫•c ho·∫∑c d·∫≠y m·ªát. N·∫øu t√¨nh tr·∫°ng k√©o d√†i, b·∫°n n√™n trao ƒë·ªïi v·ªõi b√°c sƒ© ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n c·ª• th·ªÉ.";

      case 3: // C√¢n n·∫∑ng & v√≤ng eo
        if (avg >= 4) {
          return "C√¢n n·∫∑ng v√† v√≤ng eo c·ªßa b·∫°n kh√° ·ªïn ƒë·ªãnh, kh√¥ng bi·∫øn ƒë·ªông th·∫•t th∆∞·ªùng. ƒê√¢y l√† t√≠n hi·ªáu t·ªët cho s·ª± c√¢n b·∫±ng c·ªßa insulin, cortisol v√† tuy·∫øn gi√°p.";
        }
        if (avg >= 3) {
          return "C√¢n n·∫∑ng ho·∫∑c v√≤ng eo c√≥ l√∫c ch∆∞a ·ªïn ƒë·ªãnh, nh∆∞ng ch∆∞a ƒë·∫øn m·ª©c b√°o ƒë·ªông. H√£y ch√∫ √Ω h∆°n ƒë·∫øn ch·∫ø ƒë·ªô ƒÉn, gi·∫•c ng·ªß v√† m·ª©c ƒë·ªô v·∫≠n ƒë·ªông h√†ng ng√†y.";
        }
        return "C√¢n n·∫∑ng ho·∫∑c v√≤ng eo c·ªßa b·∫°n thay ƒë·ªïi b·∫•t th∆∞·ªùng trong th·ªùi gian g·∫ßn ƒë√¢y. B·∫°n n√™n xem l·∫°i kh·∫©u ph·∫ßn ƒÉn, m·ª©c ƒë·ªô v·∫≠n ƒë·ªông v√† c√¢n nh·∫Øc ƒëi ki·ªÉm tra n·∫øu th·∫•y thay ƒë·ªïi qu√° nhanh.";

      case 4: // Da & m√≥ng
        if (avg >= 4) {
          return "Da v√† m√≥ng c·ªßa b·∫°n nh√¨n chung h·ªìng h√†o, kho·∫ª kho·∫Øn. ƒê√¢y l√† d·∫•u hi·ªáu kh√≠ huy·∫øt, tu·∫ßn ho√†n v√† dinh d∆∞·ª°ng t·∫ø b√†o ƒëang kh√° t·ªët.";
        }
        if (avg >= 3) {
          return "Da ho·∫∑c m√≥ng c·ªßa b·∫°n c√≥ nh·ªØng giai ƒëo·∫°n x·ªân m√†u, kh√¥, d·ªÖ g√£y. ƒêi·ªÅu n√†y c√≥ th·ªÉ li√™n quan ƒë·∫øn thi·∫øu ng·ªß, stress ho·∫∑c ch·∫ø ƒë·ªô dinh d∆∞·ª°ng ch∆∞a t·ªëi ∆∞u.";
        }
        return "Da x·ªân m√†u, m√≥ng y·∫øu ho·∫∑c thay ƒë·ªïi b·∫•t th∆∞·ªùng k√©o d√†i l√† t√≠n hi·ªáu n√™n xem l·∫°i dinh d∆∞·ª°ng, l·ªëi s·ªëng v√† ch·ªß ƒë·ªông ki·ªÉm tra s·ª©c kh·ªèe (gan, th·∫≠n, thi·∫øu m√°u‚Ä¶) khi c·∫ßn.";

      case 5: // C·∫£m x√∫c & tinh th·∫ßn
        if (avg >= 4) {
          return "C·∫£m x√∫c c·ªßa b·∫°n t∆∞∆°ng ƒë·ªëi ·ªïn ƒë·ªãnh, √≠t c√°u g·∫Øt v√† c√≥ kh·∫£ nƒÉng l·∫•y l·∫°i b√¨nh tƒ©nh sau stress. ƒê√¢y l√† d·∫•u hi·ªáu h·ªá th·∫ßn kinh v√† hormon stress ƒëang ƒë∆∞·ª£c ki·ªÉm so√°t t·ªët.";
        }
        if (avg >= 3) {
          return "B·∫°n v·∫´n ƒë·ªëi m·∫∑t v·ªõi stress v√† c√≥ nh·ªØng l√∫c c·∫£m x√∫c b·ªã k√©o xu·ªëng, nh∆∞ng ·ªü m·ª©c ch·∫•p nh·∫≠n ƒë∆∞·ª£c. H√£y th√™m c√°c th√≥i quen h·ªó tr·ª£ nh∆∞ thi·ªÅn, yoga, ƒëi b·ªô ho·∫∑c vi·∫øt nh·∫≠t k√Ω.";
        }
        return "C·∫£m x√∫c c·ªßa b·∫°n d·ªÖ b·ªã dao ƒë·ªông m·∫°nh, lo √¢u ho·∫∑c cƒÉng th·∫≥ng k√©o d√†i. N·∫øu ƒëi·ªÅu n√†y ·∫£nh h∆∞·ªüng nhi·ªÅu ƒë·∫øn cu·ªôc s·ªëng, b·∫°n n√™n ∆∞u ti√™n chƒÉm s√≥c s·ª©c kh·ªèe tinh th·∫ßn v√† c√¢n nh·∫Øc t√¨m s·ª± h·ªó tr·ª£ t·ª´ chuy√™n gia.";

      case 6: // Ti√™u ho√°
        if (avg >= 4) {
          return "H·ªá ti√™u ho√° c·ªßa b·∫°n ƒëang ho·∫°t ƒë·ªông kh√° t·ªët: √≠t ƒë·∫ßy b·ª•ng, √≠t r·ªëi lo·∫°n. ƒê√¢y l√† n·ªÅn t·∫£ng quan tr·ªçng v√¨ 70% mi·ªÖn d·ªãch n·∫±m ·ªü h·ªá ti√™u ho√°.";
        }
        if (avg >= 3) {
          return "B·∫°n ƒë√¥i khi v·∫´n g·∫∑p v·∫•n ƒë·ªÅ v·ªÅ ti√™u ho√° (ƒë·∫ßy b·ª•ng, t√°o b√≥n, kh√≥ ti√™u), nh∆∞ng ch∆∞a qu√° nghi√™m tr·ªçng. H√£y tƒÉng rau xanh, ch·∫•t x∆°, u·ªëng ƒë·ªß n∆∞·ªõc v√† v·∫≠n ƒë·ªông ƒë·ªÅu.";
        }
        return "C√°c v·∫•n ƒë·ªÅ ti√™u ho√° nh∆∞ ƒë·∫ßy b·ª•ng, t√°o b√≥n ho·∫∑c r·ªëi lo·∫°n k√©o d√†i l√† t√≠n hi·ªáu c·∫ßn ƒë∆∞·ª£c quan t√¢m. N·∫øu kh√¥ng c·∫£i thi·ªán v·ªõi ƒëi·ªÅu ch·ªânh l·ªëi s·ªëng, b·∫°n n√™n ƒëi kh√°m ƒë·ªÉ ki·ªÉm tra k·ªπ h∆°n.";

      case 7: // Mi·ªÖn d·ªãch & h·ªìi ph·ª•c
        if (avg >= 4) {
          return "B·∫°n √≠t ·ªëm v·∫∑t v√† th∆∞·ªùng h·ªìi ph·ª•c kh√° nhanh khi m·ªát ho·∫∑c b·ªã c·∫£m. ƒê√¢y l√† d·∫•u hi·ªáu h·ªá mi·ªÖn d·ªãch ƒëang l√†m vi·ªác hi·ªáu qu·∫£.";
        }
        if (avg >= 3) {
          return "Th·ªânh tho·∫£ng b·∫°n v·∫´n hay c·∫£m nh·∫π ho·∫∑c m·ªát khi th·ªùi ti·∫øt thay ƒë·ªïi. H√£y ch√∫ √Ω ng·ªß ƒë·ªß gi·∫•c, ƒÉn u·ªëng l√†nh m·∫°nh v√† v·∫≠n ƒë·ªông ƒëi·ªÅu ƒë·ªô ƒë·ªÉ n√¢ng s·ª©c ƒë·ªÅ kh√°ng.";
        }
        return "B·∫°n kh√° d·ªÖ ·ªëm v·∫∑t ho·∫∑c h·ªìi ph·ª•c ch·∫≠m sau khi b·ªã b·ªánh. N√™n xem l·∫°i th√≥i quen sinh ho·∫°t, tƒÉng c∆∞·ªùng dinh d∆∞·ª°ng v√† c√¢n nh·∫Øc g·∫∑p b√°c sƒ© n·∫øu t√¨nh tr·∫°ng n√†y k√©o d√†i.";
    }
  }

  function calculateTestResult() {
    let totalSum = 0;
    let totalCount = 0;

    const groupSums = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0 };
    const groupCounts = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0 };

    QUESTIONS.forEach(q => {
      const value = answers[q.id];
      if (!value) return;
      totalSum += value;
      totalCount += 1;
      groupSums[q.groupId] += value;
      groupCounts[q.groupId] += 1;
    });

    const overallAverage = totalCount > 0 ? totalSum / totalCount : 0;
    const overall = classifyOverall(parseFloat(overallAverage.toFixed(2)));

    const groups = Object.keys(groupSums).map(key => {
      const groupId = parseInt(key, 10);
      const sum = groupSums[groupId];
      const count = groupCounts[groupId] || 1;
      const avg = sum / count;
      const { status, statusLabel } = classifyGroupAverage(avg);
      const message = getGroupMessage(groupId, avg);

      return {
        groupId,
        rawSum: sum,
        questionCount: count,
        average: parseFloat(avg.toFixed(2)),
        status,
        statusLabel,
        message,
      };
    }).sort((a, b) => a.groupId - b.groupId);

    return { overall, groups };
  }

  function renderResult() {
    const { overall, groups } = resultCache;
    document.getElementById("overall-score").textContent =
      overall.average.toFixed(2) + " / 5";
    document.getElementById("overall-title").textContent = overall.title;
    document.getElementById("overall-message").textContent = overall.message;

    const groupsList = document.getElementById("groups-list");
    groupsList.innerHTML = "";
    groups.forEach(g => {
      const card = document.createElement("div");
      card.className = "card";

      const header = document.createElement("div");
      header.className = "group-header";

      const left = document.createElement("div");
      left.innerHTML = `<div class="group-name">${GROUP_NAMES[g.groupId]}</div>`;

      const right = document.createElement("div");
      right.className = "group-score";
      right.textContent = `${g.average.toFixed(2)} / 5`;

      header.appendChild(left);
      header.appendChild(right);

      const chip = document.createElement("div");
      chip.className = "chip " + g.status;
      chip.textContent = g.statusLabel;

      card.appendChild(header);
      card.appendChild(chip);
      groupsList.appendChild(card);
    });
  }

  function renderDetail() {
    const { groups } = resultCache;
    const container = document.getElementById("detail-list");
    container.innerHTML = "";

    groups.forEach(g => {
      const card = document.createElement("div");
      card.className = "card";

      const header = document.createElement("div");
      header.className = "group-header";

      const left = document.createElement("div");
      left.className = "group-name";
      left.textContent = GROUP_NAMES[g.groupId];

      const right = document.createElement("div");
      right.className = "group-score";
      right.textContent = `${g.average.toFixed(2)} / 5`;

      header.appendChild(left);
      header.appendChild(right);

      const chip = document.createElement("div");
      chip.className = "chip " + g.status;
      chip.textContent = g.statusLabel;

      const msg = document.createElement("div");
      msg.className = "card-body";
      msg.style.marginTop = "6px";
      msg.textContent = g.message;

      card.appendChild(header);
      card.appendChild(chip);
      card.appendChild(msg);
      container.appendChild(card);
    });
  }

  // ---------- EVENT BINDING ----------

  document.getElementById("btn-start-quiz").addEventListener("click", () => {
    currentIndex = 0;
    answers = {};
    renderQuestion();
    showScreen("screen-quiz");
  });

  document.getElementById("btn-view-signs").addEventListener("click", () => {
    showScreen("screen-signs");
  });

  document.getElementById("btn-signs-start").addEventListener("click", () => {
    currentIndex = 0;
    answers = {};
    renderQuestion();
    showScreen("screen-quiz");
  });

  document.getElementById("btn-prev").addEventListener("click", () => {
    if (currentIndex > 0) {
      currentIndex--;
      renderQuestion();
    }
  });

  document.getElementById("btn-next").addEventListener("click", () => {
    const q = QUESTIONS[currentIndex];
    const selected = document.querySelector('input[name="answer"]:checked');
    if (!selected) {
      showToast("H√£y ch·ªçn m·ªôt m·ª©c ƒë·ªô ph√π h·ª£p tr∆∞·ªõc khi ti·∫øp t·ª•c.");
      return;
    }
    answers[q.id] = parseInt(selected.value, 10);

    if (currentIndex < QUESTIONS.length - 1) {
      currentIndex++;
      renderQuestion();
    } else {
      // done
      resultCache = calculateTestResult();
      renderResult();
      showScreen("screen-result");
    }
  });

  document.getElementById("btn-view-details").addEventListener("click", () => {
    renderDetail();
    showScreen("screen-detail");
  });

  document.getElementById("btn-restart").addEventListener("click", () => {
    currentIndex = 0;
    answers = {};
    renderQuestion();
    showScreen("screen-quiz");
  });

  document.getElementById("btn-detail-back").addEventListener("click", () => {
    showScreen("screen-result");
  });

  document.getElementById("btn-detail-home").addEventListener("click", () => {
    showScreen("screen-intro");
  });

  document.getElementById("back-btn").addEventListener("click", () => {
    const screens = {
      "screen-signs": "screen-intro",
      "screen-quiz": "screen-intro",
      "screen-result": "screen-intro",
      "screen-detail": "screen-result",
    };
    const current = Object.entries(screens).find(
      ([id]) => document.getElementById(id).style.display === "block"
    );
    if (current) {
      showScreen(current[1]);
    } else {
      showScreen("screen-intro");
    }
  });

  // Kh·ªüi ƒë·ªông
  showScreen("screen-intro");
</script>
</body>
</html>

